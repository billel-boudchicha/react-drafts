<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    <meta charset="UTF-8">

{% seo %}
    <meta name="description" content="{{ page.description | default: site.description | default: site.github.project_tagline }}"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">
    <link rel="stylesheet" href="./dist/react-drafts.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.35.3/es6-shim.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.23.1/babel.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react-dom.min.js" type="text/javascript"></script>
    <style>
      .drafts-editor,
      .drafts-editor__toolbar,
      .drafts-editor__toolbar .controls,
      .drafts-editor__toolbar.detached .controls {
        width: 90%;
        max-width: 960px;
        margin: 30px auto 40px;
      }
    </style>
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">{{ site.title | default: site.github.repository_name }}</h1>
      <h2 class="project-tagline">{{ site.description | default: site.github.project_tagline }}</h2>
      {% if site.github.is_project_page %}
        <a href="{{ site.github.repository_url }}" class="btn">View on GitHub</a>
      {% endif %}
      {% if site.show_downloads %}
        <a href="{{ site.github.zip_url }}" class="btn">Download .zip</a>
        <a href="{{ site.github.tar_url }}" class="btn">Download .tar.gz</a>
      {% endif %}
    </section>

    <section class="main-content">
      <div id="app"></div>

      {{ content }}

      <footer class="site-footer">
        {% if site.github.is_project_page %}
          <span class="site-footer-owner"><a href="{{ site.github.repository_url }}">{{ site.github.repository_name }}</a> is maintained by <a href="{{ site.github.owner_url }}">{{ site.github.owner_name }}</a>.</span>
        {% endif %}
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </section>

    <script src="./dist/react-drafts.js" type="text/javascript"></script>
    <script type="text/babel">
      class DemoEditor extends React.Component {
        constructor() {
          super();

          this.state = {
            isSaving: false,
            lastSavedAt: null
          };

          this.handleLoadSavedContent = this.handleLoadSavedContent.bind(this);
          this.handleFileUpload = this.handleFileUpload.bind(this);
          this.handleSave = this.handleSave.bind(this);
          this.handleClear = this.handleClear.bind(this);
        }

        handleLoadSavedContent() {
          const saved = localStorage.getItem('myContent');
          return saved || '';
        }

        handleFileUpload(file) {
          return Promise.resolve({
            src: file.preview,
            name: file.name
          });
        }

        handleSave() {
          this.setState({
            isSaving: true
          }, () => {
            this.editor.save().then(content => {
              localStorage.setItem('myContent', content);

              const date = new Date();
              setTimeout(() => {
                this.setState({
                  isSaving: false,
                  lastSavedAt: date.toLocaleString()
                });
              }, 1000);
            });
          });
        }

        handleClear() {
          localStorage.removeItem('myContent');
          this.editor.clear();
        }

        render() {
          const { isSaving, lastSavedAt } = this.state;
          const storedContent = this.handleLoadSavedContent();

          return (
            <div className="demo-editor">
              <p style={{position: 'absolute', top: '16px', right: '10%', color: '#bebebe'}}>
                {lastSavedAt && `Last saved: ${lastSavedAt || ''}`}
              </p>
              <div className="drafts-editor__external-controls">
                <button className="drafts-editor__external-control clear" onClick={this.handleClear}>Clear</button>
                <button className="drafts-editor__external-control save" onClick={this.handleSave}>
                  { isSaving ? 'Saving' : 'Save' }
                </button>
              </div>
              <ReactDrafts
                ref={editor => this.editor = editor}
                content={storedContent}
                onFileUpload={this.handleFileUpload}
                allowPhotoLink={true}
                allowPhotoSizeAdjust={true}
                maxImgWidth={900}
                linkInputAcceptsFiles={true}
                exportTo="html"
              />
            </div>
          );
        }
      }

      ReactDOM.render(
        <DemoEditor />,
        document.getElementById('app')
      );
    </script>

    {% if site.google_analytics %}
      <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', '{{ site.google_analytics }}', 'auto');
        ga('send', 'pageview');
      </script>
    {% endif %}
  </body>
</html>
